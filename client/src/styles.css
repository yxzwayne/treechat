:root {
  --bg: #0b0c0f;
  --panel: #12141a;
  --card: #161922;
  --text: #e6e8ef;
  --muted: #9aa0ab;
  --accent: #1ca7ea;
  --border: #242938;
  --topbar-h: 44px;
  --col-w: 720px;
  --sidebar-w: 300px;
  --col-gap: 12px;
  --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  --font-serif: ui-serif, Georgia, "Times New Roman", Times, serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
* { box-sizing: border-box; }
html, body, #root { height: 100%; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: var(--font-sans); }

.app-shell { display: grid; grid-template-rows: 1fr; height: 100%; }
/* header removed */
.title { font-family: var(--font-serif); font-size: 1.4rem; font-weight: bold; letter-spacing: 2px; margin-bottom: 0.5rem;}
.container { display: block; height: 100%; }
.left-pane { position: fixed; top: 0; bottom: 0; left: 0; width: var(--sidebar-w); border-right: 1px solid var(--border); background: var(--panel); padding: 12px; overflow: auto; }
.tree-pane { height: 100%; overflow: auto; padding: 12px; margin-left: var(--sidebar-w); margin-right: var(--sidebar-w); }
.side-pane { position: fixed; top: 0; bottom: 0; right: 0; width: var(--sidebar-w); border-left: 1px solid var(--border); background: var(--panel); padding: 12px; overflow: auto; }
/* Place side panels above the top bar */
.left-pane, .side-pane { z-index: 1100; }

.node-card { background: var(--card); border: 1px solid var(--border); border-radius: 0px; padding: 10px; width: 100%;}
.node-user { border-left: 4px solid #0042ff; }
.node-assistant { border-left: 4px solid #1ca7ea; }
.node-system { border-left: 4px solid #ffb86b; font-size: 14px; }
.node-header { font-size: 13px; color: var(--muted); display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
.node-content { white-space: pre-wrap; font-size: 15px; }

.children-row { display: flex; gap: var(--col-gap); align-items: flex-start; margin-left: 0; margin-top: 12px; }
/*
  Make each column expand to fit its subtree width. This ensures that when a new
  branch is created at some depth, the parent column grows horizontally, which in
  turn shifts columns to its right, instead of letting nested children overflow
  and get covered by existing columns.
*/
.column { width: var(--col-w); max-width: var(--col-w); flex: 0 0 var(--col-w); display: flex; flex-direction: column; gap: 8px; margin-right: calc(var(--extra-cols, 0) * (var(--col-w) + var(--col-gap))); }
/* Optional, reserved if we ever need explicit spacer element */
.column-spacer { flex: 0 0 auto; }

.controls { display: flex; gap: 8px; align-items: center; }
.button { background: #1f2432; color: var(--text); border: 1px solid var(--border); padding: 6px 12px; border-radius: 2px; cursor: pointer; font-family: var(--font-mono); font-size: 14px; }
.button:hover { background: #23293a; }
.button.ghost { background: transparent; }
.button.small { padding: 2px 8px; font-size: 12px; }
.button.accent { background: var(--accent); color: black; border: none; }
.button.pale { background: #203041; color: #d7eaff; border: 1px solid #27445f; }
.button.pale:hover { background: #25455f; }
.button.danger { background: #c62828; color: #fff; border: 1px solid #9a1e1e; }
.button.danger:hover { background: #b71c1c; }
.icon-button { background: transparent; border: none; padding: 4px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; }
.icon-button:hover svg path { stroke: #c1c7d0; }

/* Unified sidebar open/close buttons */
.sidepanel-toggle-btn {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
  width: 32px;
  height: 32px;
  border-radius: 2px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
}
.sidepanel-toggle-btn:hover svg path { stroke: #c1c7d0; }

.text-input, .composer .ta { width: 100%; padding: 10px; border: 1px solid var(--border); background: #0f1117; color: var(--text); }
.text-input { flex: 1; max-width: 100%; border-radius: 8px; display: block; box-sizing: border-box; }
.node-card textarea.text-input { resize: none; overflow: auto; font-size: 14px; font-family: var(--font-mono); }

/* .active { outline: 1px dashed var(--accent); } */

.mono { font-family: var(--font-mono); }

.composer { margin-top: 8px; }
.composer .ta { resize: none; overflow: hidden; font-size: 15px; font-family: var(--font-mono); }
.composer .row { display: flex; gap: 8px; margin-top: 6px; justify-content: flex-end; }

.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
.modal { background: #141924; border: 1px solid var(--border); width: 560px; max-width: 90vw; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
.modal-body { color: #cfd3dc; font-size: 15px; }
.modal-actions { margin-top: 12px; display: flex; gap: 8px; justify-content: flex-end; }

.toast { position: fixed; right: 16px; top: 16px; background: #1b2130; color: #e6e8ef; border: 1px solid #2a3246; padding: 8px 12px; border-radius: 4px; box-shadow: 0 6px 20px rgba(0,0,0,0.4); z-index: 2000; font-size: 13px; }

/* Left sidebar chat items */
.chat-item { text-align: left; color: var(--text); font-family: var(--font-mono); font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; min-width: 0; position: relative; }
.chat-row { display: flex; align-items: center; gap: 6px; padding: 4px 6px; border: 1px solid transparent; border-radius: 2px; cursor: pointer; transition: background-color 0.12s ease, border-color 0.12s ease; }
.chat-row:hover { background: #141822; border-color: #1f2535; }
.chat-row.active { background: #182036; border-color: #283556; }
.chat-row .chat-delete { opacity: 0; transition: opacity 0.12s ease-in-out; }
.chat-row:hover .chat-delete { opacity: 1; }
/* Show edit icon only on hover, like delete */
.chat-row .chat-edit { opacity: 0; transition: opacity 0.12s ease-in-out; }
.chat-row:hover .chat-edit { opacity: 1; }
/* Match edit icon default color to trash bin */
.chat-row .chat-edit { color: #9aa0ab; }
/* Base color for save (tick) and cancel (cross) icons */
.chat-row .chat-save, .chat-row .chat-cancel { color: #9aa0ab; }

.history-header {
  margin-bottom: 8px;
}
.chat-row.history-header:hover {
  background: transparent;
  border-color: transparent;
  cursor: default;
  transition: none;
}

/* Edit summary textarea */
.edit-summary {
  width: 100%;
  resize: none;
  font-size: 13px; /* Match .chat-item to avoid height change */
  font-family: var(--font-mono);
  border: 0;
  padding: 0;
  background: transparent;
  color: var(--text);
  line-height: 1.2;
  height: 1.2em; /* Force single-line height */
  overflow-y: hidden; /* No vertical scrollbar */
  overflow-x: auto; /* Allow horizontal scroll */
  white-space: pre; /* Keep single-line; works with wrap="off" */
}
.edit-summary:focus {
  outline: none;
}

/* Inline field popover for character limit */
.field-popover {
  position: absolute;
  left: 0;
  top: calc(100% + 4px);
  background: #1b2130;
  color: #e6e8ef;
  border: 1px solid #2a3246;
  padding: 4px 8px;
  border-radius: 3px;
  font-size: 12px;
  white-space: normal;
  z-index: 20;
  pointer-events: none;
}

/* Floating toggles for sidebars */
.floating-toggle { position: fixed; top: 10px; z-index: 1500; box-shadow: 0 4px 14px rgba(0,0,0,0.4); }
.floating-toggle.left { left: 10px; }
.floating-toggle.right { right: 10px; }

/* Transparent top header bar */
.top-bar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: var(--topbar-h);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  background: transparent;
  border: none;
  z-index: 1000;
  /* Let clicks pass through except on explicit controls */
  pointer-events: none;
}

/* Re-enable interaction for the toggle buttons inside the top bar */
.top-bar .sidepanel-toggle-btn { pointer-events: auto; }

/* Ensure content isn't obscured by the fixed top bar */
.tree-pane { padding-top: calc(12px + var(--topbar-h)); }
